<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="This is my personal blog">

        <meta property="og:title" content="Normalization and mocks | Jos√© Postiga / Senior Backend Developer"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://josepostiga.com/journal/2019-02-08-normalization-and-mocks"/>
        <meta property="og:description" content="This is my personal blog" />

        <title>Jos√© Postiga / Senior Backend Developer | Normalization and mocks</title>

        <link rel="home" href="https://josepostiga.com">
        <link rel="icon" href="/favicon.ico">
        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="Jos√© Postiga / Senior Backend Developer Atom Feed">

            <meta property="og:title" content="Normalization and mocks" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://josepostiga.com/journal/2019-02-08-normalization-and-mocks"/>
    <meta property="og:description" content="" />

        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=3efdaaf93f1abadd4391">
    </head>

    <body class="flex flex-col justify-between min-h-screen bg-grey-lightest text-grey-darkest leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 py-4" role="banner">
            <div class="container flex items-center max-w-xl mx-auto px-6">
                <nav class="lg:flex items-center justify-end text-sm md:text-lg">
                    <a title="Jos√© Postiga / Senior Backend Developer" href="/" class="mr-5 text-grey-darker hover:text-blue-dark ">
                        About
                    </a>

                    <a title="Jos√© Postiga / Senior Backend Developer Journal" href="/journal" class="mr-5 text-grey-darker hover:text-blue-dark ">
                        Journal
                    </a>

                    <a title="Jos√© Postiga / Senior Backend Developer Articles" href="/articles" class="mr-5 text-grey-darker hover:text-blue-dark ">
                        Articles
                    </a>
                </nav>

                <div id="vue-search" class="flex flex-1 justify-end items-center">
                    <search></search>
                </div>
            </div>
        </header>

        <main role="main" class="flex-auto w-full container max-w-xl mx-auto py-16 px-6">
                        <img src="https://c10.patreonusercontent.com/3/eyJ3IjoxNjAwfQ%3D%3D/patreon-media/p/post/24547191/dd0571cd7b524c74851e921b27f7acf9/2?token-time=1552176000&amp;token-hash=_VXE-mcGNEJifBM3fOk36e_WWflqn4U4uADLB6KsZXA%3D" alt="Normalization and mocks cover image" class="mb-2 w-full">
    
    <h1 class="leading-none mt-1 mb-2">Normalization and mocks</h1>

    <p class="text-grey-darker text-xl md:mt-0">Jos√© Postiga  ‚Ä¢  08/02/2019</p>

    <div class="mb-10 pb-4" v-pre>
        <p>I finally finished all my tasks regarding the implementation of the code sniffers and fixers on all my teammates' computers and advanced to other, more challenging tasks. The one I'm currently working on is related to reports generation.</p>
<p>Since reports are a very sensitive part of our software, I started unit testing a specific report class, making sure that it behaves as expected, returning the required, basic, information (like the report's name, configuration) and got to the part of ensuring the right methods are called to generate a PDF. I stopped... The report classes use a third-party library to handle the generation of the PDF file and, to generate a file, at the very least, one method needed to be called. How could I ensure that that method was, in fact, called, without testing the third party code, itself?</p>
<p>Like I said before, I'm not an expert on TDD, but I know enough to answer this: we Mock that behaviour, creating the expectation required to ensure that a certain method(s) is(are) called. On this particular case, I needed to ensure that some options were set and that the method to load a view, to be generated as a PDF, was called. So I started mocking the behaviour, setting the required expectations.</p>
<p>When I tried to run the test, it broke... But, why? Going through the output of the error, I got the feedback that the class was being mocked more than once. Ok, but how? I went finding more information about the error message returned, on our lord and saviour Google. It turned out that Laravel Fa√ßades already have it activated when running in a test environment. Always learning, hein? I thought it's pretty cool. After removing the mocking definition, the &quot;Mockery::mock(Foo::class)&quot; part, tests went green! Right on time to commit the work in progress and leave for the day.</p>
<p>On our beloved HUB project, as I promised, I have advanced to the next part of the development of the users' module. I switched from unit tests to feature tests, where I began testing the creation of a user account. While doing this, I started implementing the repository class, too.</p>
<p>This is the Tests\Feature\UsersTest class, right now:</p>
<p><img src="https://c10.patreonusercontent.com/3/eyJ3IjoxMjQwfQ%3D%3D/patreon-media/p/post/24547191/c35c0974fc434ddea20d57bcec0f2317/1?token-time=1552176000&amp;token-hash=9OeiGwmEwabY5ryeZyWHJBYsf-bljQPnKURTUHY1CYA%3D" alt="" /></p>
<p>It's incredible how little code can test so many parts of the software: the existence of the correct endpoint, the request validated input, the lack of errors on session, the correct redirection to the users' index page, that it only may be done by someone logged in and that the record is, in fact, saved to the persistent layer (thus, it tests that the repository class does communicate to this layer). Perfect!</p>
<p>Are you interested in seeing the repository? Here:</p>
<p><img src="https://c10.patreonusercontent.com/3/eyJ3IjoxMjQwfQ%3D%3D/patreon-media/p/post/24547191/778a07133f6b41efb3934f5385961c48/1?token-time=1552176000&amp;token-hash=XS8Kym_sGz0zQY24qWlCJq07EotOs74uOMYAzdXBIEs%3D" alt="" /></p>
<p>Of course, it's incomplete. It's a work in progress and, so far, I only implemented the save method. Laravel's Service Container makes dependency injection so easy it's hard to belive that just by type-hinting the correct model class, in the constructor, is enough to connect it to the repository class and use the underlying behaviour.</p>
<p>Tomorrow I'll work through the rest of this users' module. ü§ì</p>    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://josepostiga.com/journal/2019-02-07-keep-calm-and-tdd" title="Older Post: Keep calm and TDD">
                    &LeftArrow; Keep calm and TDD
                </a>
                    </div>

        <div>
                            <a href="https://josepostiga.com/journal/2019-02-09-small-firm-steps" title="Newer Post: Small, firm, steps">
                    Small, firm, steps &RightArrow;
                </a>
                    </div>
    </nav>
        </main>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-reset">
                <li class="md:mr-2">
                    &copy; Jos√© Postiga 2019.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                    Theme &copy; <a href="https://tighten.co" title="Tighten website">Tighten</a>
                </li>
            </ul>
        </footer>

        <script src="/assets/build/js/main.js?id=64ed8d254cb6b2c1ec00"></script>

            </body>
</html>
